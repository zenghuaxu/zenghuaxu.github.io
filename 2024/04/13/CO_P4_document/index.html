<!-- build time:Sun Apr 14 2024 18:13:42 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Zeng HX's Blog" href="http://example.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="Zeng HX's Blog" href="http://example.com/atom.xml"><link rel="alternate" type="application/json" title="Zeng HX's Blog" href="http://example.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="单周期CPU,mips,Verilog HDL"><link rel="canonical" href="http://example.com/2024/04/13/CO_P4_document/"><title>CO_P4_document - 计算机组成 | Zeng HX = Zeng HX's Blog</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">CO_P4_document</h1><div class="meta"><span class="item" title="创建时间：2024-04-13 23:36:11"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2024-04-13T23:36:11+08:00">2024-04-13</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>4.5k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>4 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Zeng HX</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipevarprfj20zk0m8npd.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipeuv80yoj20zk0m8kjl.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gicm07ih54j20zk0m84qp.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipevuctzzj20zk0m84qp.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giciryrr3rj20zk0m8nhk.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipevo9j1jj20zk0m8e81.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-composition/" itemprop="item" rel="index" title="分类于 计算机组成"><span itemprop="name">计算机组成</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://example.com/2024/04/13/CO_P4_document/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Zeng Huaxu"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Zeng HX's Blog"></span><div class="body md" itemprop="articleBody"><h1 id="cpu设计文档及思考题"><a class="anchor" href="#cpu设计文档及思考题">#</a> CPU 设计文档及思考题</h1><h2 id="设计草稿"><a class="anchor" href="#设计草稿">#</a> 设计草稿</h2><h4 id="顶层模块设计"><a class="anchor" href="#顶层模块设计">#</a> 顶层模块设计</h4><ul><li>在 P3 的基础上，将其顶层结构翻译映射为 Verilog HDL 的工程文件。</li><li>因此，对 P3 文档稍加修订，得到顶层模块的工程设计如下<ul><li>数据通路<br><img data-src="images/20d20ea83ec1ffd6106748bbebc5fc3683832d851e1f8f1052bb90d97a663cbe.png" alt="图 2"></li><li>控制<table><thead><tr><th style="text-align:center">指令</th><th style="text-align:center">NPCMode[1:0]</th><th style="text-align:center">RegWrite</th><th style="text-align:center">ALUOp[3:0]</th><th style="text-align:center">MemoryWrite</th><th style="text-align:center">ExtOp[1:0]</th><th style="text-align:center">ALUSrc[1:0]</th><th style="text-align:center">GRFSrc[1:0]</th><th style="text-align:center">GRFA3Src[1:0]</th></tr></thead><tbody><tr><td style="text-align:center">add</td><td style="text-align:center">00</td><td style="text-align:center">1</td><td style="text-align:center">0000</td><td style="text-align:center">0</td><td style="text-align:center">xx</td><td style="text-align:center">00</td><td style="text-align:center">00</td><td style="text-align:center">00</td></tr><tr><td style="text-align:center">sub</td><td style="text-align:center">00</td><td style="text-align:center">1</td><td style="text-align:center">0001</td><td style="text-align:center">0</td><td style="text-align:center">xx</td><td style="text-align:center">00</td><td style="text-align:center">00</td><td style="text-align:center">00</td></tr><tr><td style="text-align:center">ori</td><td style="text-align:center">00</td><td style="text-align:center">1</td><td style="text-align:center">0010</td><td style="text-align:center">0</td><td style="text-align:center">00</td><td style="text-align:center">01</td><td style="text-align:center">00</td><td style="text-align:center">01</td></tr><tr><td style="text-align:center">lw</td><td style="text-align:center">00</td><td style="text-align:center">1</td><td style="text-align:center">0000</td><td style="text-align:center">0</td><td style="text-align:center">01</td><td style="text-align:center">01</td><td style="text-align:center">01</td><td style="text-align:center">01</td></tr><tr><td style="text-align:center">sw</td><td style="text-align:center">00</td><td style="text-align:center">0</td><td style="text-align:center">0000</td><td style="text-align:center">1</td><td style="text-align:center">01</td><td style="text-align:center">01</td><td style="text-align:center">xx</td><td style="text-align:center">xx</td></tr><tr><td style="text-align:center">beq</td><td style="text-align:center">01</td><td style="text-align:center">0</td><td style="text-align:center">0001</td><td style="text-align:center">0</td><td style="text-align:center">xx</td><td style="text-align:center">00</td><td style="text-align:center">xx</td><td style="text-align:center">xx</td></tr><tr><td style="text-align:center">lui</td><td style="text-align:center">00</td><td style="text-align:center">1</td><td style="text-align:center">0011</td><td style="text-align:center">0</td><td style="text-align:center">xx</td><td style="text-align:center">01</td><td style="text-align:center">00</td><td style="text-align:center">01</td></tr><tr><td style="text-align:center">jal</td><td style="text-align:center">10</td><td style="text-align:center">1</td><td style="text-align:center">xxxx</td><td style="text-align:center">0</td><td style="text-align:center">xx</td><td style="text-align:center">xx</td><td style="text-align:center">10</td><td style="text-align:center">10</td></tr><tr><td style="text-align:center">jr</td><td style="text-align:center">11</td><td style="text-align:center">0</td><td style="text-align:center">xxxx</td><td style="text-align:center">0</td><td style="text-align:center">xx</td><td style="text-align:center">xx</td><td style="text-align:center">xx</td><td style="text-align:center">xx</td></tr><tr><td style="text-align:center">nop</td><td style="text-align:center">00</td><td style="text-align:center">0</td><td style="text-align:center">xxxx</td><td style="text-align:center">0</td><td style="text-align:center">xx</td><td style="text-align:center">xx</td><td style="text-align:center">xx</td><td style="text-align:center">xx</td></tr></tbody></table></li></ul></li></ul><h4 id="子模块"><a class="anchor" href="#子模块">#</a> 子模块</h4><ul><li><p>程序计数器 PC</p><table><thead><tr><th style="text-align:center">信号名</th><th style="text-align:center">方向</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">Clk</td><td style="text-align:center">Input</td><td style="text-align:center">时钟</td></tr><tr><td style="text-align:center">Reset</td><td style="text-align:center">Input</td><td style="text-align:center">同步复位到 0x00003000</td></tr><tr><td style="text-align:center">In</td><td style="text-align:center">Input[31:0]</td><td style="text-align:center">npc</td></tr><tr><td style="text-align:center">Out</td><td style="text-align:center">Output[31:0]</td><td style="text-align:center">pc</td></tr></tbody></table></li><li><p>下一指令运算器 NPC</p><table><thead><tr><th style="text-align:center">信号名</th><th style="text-align:center">方向</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">Mode</td><td style="text-align:center">Input[2:0]</td><td style="text-align:center">运算模式</td></tr><tr><td style="text-align:center">Zero</td><td style="text-align:center">Input</td><td style="text-align:center">ALU 结果是否为零</td></tr><tr><td style="text-align:center">pc</td><td style="text-align:center">Input[31:0]</td><td style="text-align:center">PC</td></tr><tr><td style="text-align:center">Imm</td><td style="text-align:center">Input[25:0]</td><td style="text-align:center">25 位立即数</td></tr><tr><td style="text-align:center">ra</td><td style="text-align:center">Input[31:0]</td><td style="text-align:center">ra</td></tr><tr><td style="text-align:center">pc4</td><td style="text-align:center">Output[31:0]</td><td style="text-align:center">PC+4</td></tr><tr><td style="text-align:center">npc</td><td style="text-align:center">Output[31:0]</td><td style="text-align:center">NPC</td></tr></tbody></table></li><li><p>指令存储器 IM</p><table><thead><tr><th style="text-align:center">信号名</th><th style="text-align:center">方向</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">A</td><td style="text-align:center">Input[13:2]</td><td style="text-align:center">指令的字节地址 - 0x00003000</td></tr><tr><td style="text-align:center">Instr</td><td style="text-align:center">Output[31:0]</td><td style="text-align:center">指令</td></tr></tbody></table></li><li><p>寄存器堆 GRF</p><table><thead><tr><th style="text-align:center">信号名</th><th style="text-align:center">方向</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">Clk</td><td style="text-align:center">Input</td><td style="text-align:center">时钟</td></tr><tr><td style="text-align:center">Reset</td><td style="text-align:center">Input</td><td style="text-align:center">同步复位</td></tr><tr><td style="text-align:center">WE</td><td style="text-align:center">Input</td><td style="text-align:center">写使能</td></tr><tr><td style="text-align:center">A1[4:0]</td><td style="text-align:center">Input</td><td style="text-align:center">操作数 1 地址</td></tr><tr><td style="text-align:center">A2[4:0]</td><td style="text-align:center">Input</td><td style="text-align:center">操作数 2 地址</td></tr><tr><td style="text-align:center">A3[4:0]</td><td style="text-align:center">Input</td><td style="text-align:center">操作数 3 地址</td></tr><tr><td style="text-align:center">WD[31:0]</td><td style="text-align:center">Input</td><td style="text-align:center">写入数据</td></tr><tr><td style="text-align:center">D1[31:0]</td><td style="text-align:center">Output</td><td style="text-align:center">读出数据 1</td></tr><tr><td style="text-align:center">D2[31:0]</td><td style="text-align:center">Output</td><td style="text-align:center">读出数据 2</td></tr></tbody></table></li><li><p>控制器 Controller</p><table><thead><tr><th style="text-align:center">信号名</th><th style="text-align:center">方向</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">Opcode[5:0]</td><td style="text-align:center">Input</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">Funct[5:0]</td><td style="text-align:center">Input</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">NPCMode</td><td style="text-align:center">Output[2:0]</td><td style="text-align:center">NPC 模式使能</td></tr><tr><td style="text-align:center">RegWrite</td><td style="text-align:center">Output</td><td style="text-align:center">GRF 写使能</td></tr><tr><td style="text-align:center">ALUSrc[1:0]</td><td style="text-align:center">Output</td><td style="text-align:center">B 为寄存器 / 立即数</td></tr><tr><td style="text-align:center">ALUOp[3:0]</td><td style="text-align:center">Output</td><td style="text-align:center">ALU 模式</td></tr><tr><td style="text-align:center">MemoryWrite</td><td style="text-align:center">Output</td><td style="text-align:center">DM 写使能</td></tr><tr><td style="text-align:center">ExtOp[1:0]</td><td style="text-align:center">Output</td><td style="text-align:center">EXT 使能和模式</td></tr><tr><td style="text-align:center">GRFSrc[1:0]</td><td style="text-align:center">Output</td><td style="text-align:center">ALU/DM 回写</td></tr></tbody></table></li><li><p>算术逻辑运算单元 ALU</p><table><thead><tr><th style="text-align:center">信号名</th><th style="text-align:center">方向</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">A[31:0]</td><td style="text-align:center">Input</td><td style="text-align:center">操作数 1</td></tr><tr><td style="text-align:center">B[31:0]</td><td style="text-align:center">Input</td><td style="text-align:center">操作数 2</td></tr><tr><td style="text-align:center">ALUOp[3:0]</td><td style="text-align:center">Input</td><td style="text-align:center">模式</td></tr><tr><td style="text-align:center">C[31:0]</td><td style="text-align:center">Output</td><td style="text-align:center">运算结果</td></tr><tr><td style="text-align:center">Zero</td><td style="text-align:center">Output</td><td style="text-align:center">结果是否为零</td></tr></tbody></table></li><li><p>数据存储器 DM</p><table><thead><tr><th style="text-align:center">信号名</th><th style="text-align:center">方向</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">Clk</td><td style="text-align:center">Input</td><td style="text-align:center">时钟</td></tr><tr><td style="text-align:center">Reset</td><td style="text-align:center">Input</td><td style="text-align:center">同步复位</td></tr><tr><td style="text-align:center">En</td><td style="text-align:center">Input</td><td style="text-align:center">写使能</td></tr><tr><td style="text-align:center">A[31:0]</td><td style="text-align:center">Input</td><td style="text-align:center">读地址</td></tr><tr><td style="text-align:center">D[31:0]</td><td style="text-align:center">Input</td><td style="text-align:center">写数据</td></tr><tr><td style="text-align:center">Data[31:0]</td><td style="text-align:center">Output</td><td style="text-align:center">读出数据</td></tr></tbody></table></li><li><p>结合上述模块输入输出和连接关系，做出各个子模块以及顶层架构，下面展示了顶层架构：</p></li></ul><pre><code>module mips(
    input clk,
    input reset
    );
    NPC npc(.mode(controller.NPCMode),
	         .Zero(alu.Zero),
	         .pc(pc.out),
				.imm(im.Instr[25:0]),
				.ra(grf.RD1));
				
    PC pc(.clk(clk),
	       .reset(reset),
			 .in(npc.npc));
	 
    wire [31:0] IM_Addr;
    assign IM_Addr = pc.out - 32'h0000_3000;	 
	 IM im(.A(IM_Addr[13:2]));		 

    GRF grf(.clk(clk),
            .reset(reset),
            .WE(controller.RegWrite),
				.A1(im.Instr[25:21]),
				.A2(im.Instr[20:16]),
				.A3(mux_grf_A3.B),
				.WD(mux_grf_D.B),
				.pc(pc.out));				

    ALU alu(.A(grf.RD1),
	         .B(mux_alu_B.B),
				.ALUOp(controller.ALUOp));

    DM dm(.clk(clk),
	       .reset(reset),
			 .WE(controller.MemoryWrite),
			 .A(alu.C[13:0]),
			 .D(grf.RD2),
			 .pc(pc.out));
			 
	 EXT ext(.imm(im.Instr[15:0]),
	         .EXTOp(controller.EXTOp));		 

    MUX_5_4 mux_grf_A3(.A0(im.Instr[15:11]),
	                    .A1(im.Instr[20:16]),
							  .A2(5'h1f),
							  .chose(controller.GRFA3Src));
    
	 MUX_32_4 mux_grf_D(.A0(alu.C),
	                    .A1(dm.Data),
							  .A2(npc.pc4),
							  .chose(controller.GRFSrc));

    MUX_32_4 mux_alu_B(.A0(grf.RD2),
	                    .A1(ext.ext),
							  .chose(controller.ALUSrc));

    Controller controller(.Opcode(im.Instr[31:26]),
	                       .Funct(im.Instr[5:0]));

endmodule
</code></pre><h2 id="测试方案"><a class="anchor" href="#测试方案">#</a> 测试方案</h2><ul><li>思路<ul><li>沿用 P3 测试的思路和方法，重用其代码。可以完成 add,sub,ori,lw,sw,lui,nop 等运算和访存指令的测试。</li><li>下面是 P3 的测试方案：<br><img data-src="images/02db9f3d2ce45e0f9ffcc12a5701929ea7b1331d33d1f6f0af782ca68522e95e.png" alt="图 0"><br>例如：</li></ul><pre><code>#include&lt;stdio.h&gt;
#include&lt;stdlib.h&gt;
#include&lt;time.h&gt;
#define BATCH_SIZE 50

FILE *pCode;

int main() &#123;
    srand((unsigned int)time(0));
    pCode = fopen(&quot;mips_code.txt&quot;,&quot;w&quot;);
    char s[120];
    int i;
    for (i = 0; i&lt; 32; i++) &#123;
            sprintf(s,&quot;ori $%d,$%d,%d\n&quot;,i,i + 1,0);
            fprintf(pCode,s);
    &#125;
    fclose(pCode);
    pCode = fopen(&quot;mips_code_ori1.txt&quot;,&quot;w&quot;);
    for (i = 0; i&lt; 32; i++) &#123;
            sprintf(s,&quot;ori $%d,$%d,%d\n&quot;,i,i + 1,0xffff);
            fprintf(pCode,s);
    &#125;
    fclose(pCode);
    pCode = fopen(&quot;mips_code_ori2.txt&quot;,&quot;w&quot;);
    for (i = 0 ; i &lt; BATCH_SIZE; i++) &#123;
        sprintf(s,&quot;ori $%d,$%d,%d\n&quot;,rand()% 32,rand()%32,rand()%0x10000);
        fprintf(pCode,s);
    &#125;
    fclose(pCode);
    return 0;
&#125;

</code></pre><ul><li>对于 beq,jal,jr 等命令，手动编写了若干条指令进行测试。<br>例如：</li></ul><pre><code>.data

.text
jal loop
beq $t1,$t2,end
ori $t1,$0,114
loop:
ori $t1,$0,100
ori $t2,$t1,0
jr $ra
beq $0,$0,loop
end:

</code></pre></li></ul><h2 id="思考题"><a class="anchor" href="#思考题">#</a> 思考题</h2><ul><li>思考题 1：<ul><li>在课下实验中该 addr 信号从 ALU 的输出端口 C 来，这是因为访存时候的寻址通常是基址寻址，地址由 ALU 计算得到；但若有其他寻址方式，则还有可能从 EXT，GRF 等地方读取而来。</li><li>由 ALU 计算得到的地址是字节地址，但 DM 中的数据索引是字地址，因此应该将字节地址除以四得到字地址，即 addr [11:2]。</li></ul></li><li>思考题 2：<ul><li>对于记录 “指令对应的控制信号如何取值”, 以其中一条指令 add 为例：</li></ul><pre><code> if(add) begin
 NPCMode = 3'b000;
 RegWrite = 1'b1;
 ALUOp = 4'b0000;
 MemoryWrite = 0;
 EXTOp = 2'b00;
 ALUSrc = 2'b00;
 GRFA3Src = 2'b00;
 GRFSrc = 2'b00;
 end
</code></pre>记录每种指令对应信号的方式便于以指令为单位进行代码逻辑的查看，不同指令之间不进行耦合，有利于消除不同指令之间的逻辑冲突，能够减少 bug，也有利于直接添加指令。缺点则是代码数量偏大，每增加一个指令就需要重写全部控制信号，相当于不进行代码的复用，且检查时工作量较大。<ul><li>对于记录 “控制信号每种取值所对应的指令” 的编码方式，与搭建电路时采用或门阵列一致，示例代码如下：</li></ul><pre><code>    NPCMode[0] = beq | jr;
 	NPCMode[1] = jal | jr; 
 	NPCMode[2] = 0;
    RegWrite = add | sub | ori | lw | lui | jal;
 	ALUOp[0] = sub | beq | lui;
 	ALUOp[1] = ori | lui;
 	ALUOp[2] = 0;
 	ALUOp[3] = 0;
 	MemoryWrite = sw;
 	EXTOp[0] = lw | sw;
 	EXTOp[1] = 0;
 	ALUSrc[0] = ori | lw | sw | lui;
 	ALUSrc[1] = 0;
 	GRFA3Src[0] = ori | lw | lui;
 	GRFA3Src[1] = jal;
 	GRFSrc[0] = lw;
 	GRFSrc[1] = jal;
</code></pre>这种方式与实际实现的电路有良好的对应关系。代码量明显较少，编写和修改时工作量较小，无需列出控制信号取 0 时的指令。但是不同指令耦合在一起，修复错误和增加指令时更容易出现逻辑问题；并且为了使得代码清晰，将控制信号不同位拆开表示。考虑到已经写清楚控制逻辑真值表理清逻辑，故采用此方式。</li><li>思考题 3：<ul><li>（以上升沿 + 高电平有效为例）异步复位当中复位信号的优先级比时钟信号要高，只要复位信号为高电平，不论时钟信号是什么，立即复位。即</li></ul><pre><code>always @(posedge clk,posedge reset) begin
  if(reset) begin
    /*reset*/
  end
  /*code*/
end
</code></pre><ul><li>同步复位当中时钟信号的优先级比复位信号要高，当且仅当时钟上升沿时复位信号为高电平才进行复位，将有一个周期无其他操作。即：</li></ul><pre><code>always @(posedge clk) begin
  if(reset) begin
    /*reset*/
  end
  /*code*/
end
</code></pre></li><li>思考题 4：<br>addu 相比于 add 指令，其操作多了<pre><code class="language-temp">if temp32 ≠ temp31 then
SignalException(IntegerOverflow)
</code></pre>部分，即溢出检查，若忽略溢出，不进行检查，则操作为 else 部分<pre><code>else
GPR[rd] ← temp
endif
</code></pre>和 add 完全相同。因此，忽略溢出时，add 与 addu 是等价的。addi 和 addiu 同理。</li></ul><div class="tags"><a href="/tags/%E5%8D%95%E5%91%A8%E6%9C%9FCPU/" rel="tag"><i class="ic i-tag"></i> 单周期CPU</a> <a href="/tags/mips/" rel="tag"><i class="ic i-tag"></i> mips</a> <a href="/tags/Verilog-HDL/" rel="tag"><i class="ic i-tag"></i> Verilog HDL</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-04-14 12:42:30" itemprop="dateModified" datetime="2024-04-14T12:42:30+08:00">2024-04-14</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Zeng Huaxu 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Zeng Huaxu 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Zeng Huaxu <i class="ic i-at"><em>@</em></i>Zeng HX's Blog</li><li class="link"><strong>本文链接：</strong> <a href="http://example.com/2024/04/13/CO_P4_document/" title="CO_P4_document">http://example.com/2024/04/13/CO_P4_document/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2024/04/13/CO_P3_document/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipey0a334j20zk0m8qpt.jpg" title="CO_P3_document"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 计算机组成</span><h3>CO_P3_document</h3></a></div><div class="item right"><a href="/2024/04/13/CO_P5_document/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipetlbztpj20zk0m84qp.jpg" title="CO_P5_document"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 计算机组成</span><h3>CO_P5_document</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#cpu%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3%E5%8F%8A%E6%80%9D%E8%80%83%E9%A2%98"><span class="toc-number">1.</span> <span class="toc-text">CPU 设计文档及思考题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E8%8D%89%E7%A8%BF"><span class="toc-number">1.1.</span> <span class="toc-text">设计草稿</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B6%E5%B1%82%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.1.0.1.</span> <span class="toc-text">顶层模块设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%90%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.0.2.</span> <span class="toc-text">子模块</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%96%B9%E6%A1%88"><span class="toc-number">1.2.</span> <span class="toc-text">测试方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%9D%E8%80%83%E9%A2%98"><span class="toc-number">1.3.</span> <span class="toc-text">思考题</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2024/04/13/CO_P3_document/" rel="bookmark" title="CO_P3_document">CO_P3_document</a></li><li class="active"><a href="/2024/04/13/CO_P4_document/" rel="bookmark" title="CO_P4_document">CO_P4_document</a></li><li><a href="/2024/04/13/CO_P5_document/" rel="bookmark" title="CO_P5_document">CO_P5_document</a></li><li><a href="/2024/04/13/CO_P6_document/" rel="bookmark" title="CO_P6_document">CO_P6_document</a></li><li><a href="/2024/04/13/CO_P7_document/" rel="bookmark" title="CO_P7_document">CO_P7_document</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Zeng Huaxu" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Zeng Huaxu</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">5</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">1</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">6</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3plbmdoeFNTUw==" title="https:&#x2F;&#x2F;github.com&#x2F;zenghxSSS"><i class="ic i-github"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2024/04/13/CO_P3_document/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2024/04/13/CO_P5_document/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/computer-composition/" title="分类于 计算机组成">计算机组成</a></div><span><a href="/2024/04/13/CO_P4_document/" title="CO_P4_document">CO_P4_document</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-composition/" title="分类于 计算机组成">计算机组成</a></div><span><a href="/2024/04/13/CO_P3_document/" title="CO_P3_document">CO_P3_document</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-composition/" title="分类于 计算机组成">计算机组成</a></div><span><a href="/2024/04/13/CO_P7_document/" title="CO_P7_document">CO_P7_document</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-composition/" title="分类于 计算机组成">计算机组成</a></div><span><a href="/2024/04/13/CO_P6_document/" title="CO_P6_document">CO_P6_document</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-composition/" title="分类于 计算机组成">计算机组成</a></div><span><a href="/2024/04/13/CO_P5_document/" title="CO_P5_document">CO_P5_document</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Zeng Huaxu @ Zeng HX</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">24k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">22 分钟</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2024/04/13/CO_P4_document/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->