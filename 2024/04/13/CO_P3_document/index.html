<!-- build time:Sun Apr 14 2024 18:13:42 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Zeng HX's Blog" href="http://example.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="Zeng HX's Blog" href="http://example.com/atom.xml"><link rel="alternate" type="application/json" title="Zeng HX's Blog" href="http://example.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="单周期CPU,mips,Logisim"><link rel="canonical" href="http://example.com/2024/04/13/CO_P3_document/"><title>CO_P3_document - 计算机组成 | Zeng HX = Zeng HX's Blog</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">CO_P3_document</h1><div class="meta"><span class="item" title="创建时间：2024-04-13 23:36:10"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2024-04-13T23:36:10+08:00">2024-04-13</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>7k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>6 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Zeng HX</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giciundwu5j20zk0m8n9e.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giclj61ylzj20zk0m8b29.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipex2cdtbj20zk0m8x6p.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipexw3o58j20zk0m8e81.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gicis081o9j20zk0m8dmr.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giclh0m9pdj20zk0m8hdt.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-composition/" itemprop="item" rel="index" title="分类于 计算机组成"><span itemprop="name">计算机组成</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://example.com/2024/04/13/CO_P3_document/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Zeng Huaxu"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Zeng HX's Blog"></span><div class="body md" itemprop="articleBody"><h1 id="cpu设计文档及思考题"><a class="anchor" href="#cpu设计文档及思考题">#</a> CPU 设计文档及思考题</h1><h2 id="设计草稿"><a class="anchor" href="#设计草稿">#</a> 设计草稿</h2><h4 id="顶层模块草稿"><a class="anchor" href="#顶层模块草稿">#</a> 顶层模块草稿</h4><ul><li>整个 CPU 模块大致分为上游和下游两个有限状态机。上游是<em> Moore</em> 型的取指模块，输出将要执行的下一条指令；下游则是<em> Mealy</em> 型的译码、执行、访存、回写全过程模块。</li><li>各个子模块以及粗略连接关系的初版草稿如下图所示。接下来，将要详细讨论各个模块的输入输出和连接关系。<br><img data-src="images/2d704fb9acf79ce89de3c7cbe2eef1b921d488e0329c2a7f3e6329423d322d9b.jpg" alt=""></li></ul><h4 id="顶层模块工程设计"><a class="anchor" href="#顶层模块工程设计">#</a> 顶层模块工程设计</h4><ul><li>每条指令相应数据通路如下表所示。<br>&lt;table&gt;<br>&lt;tr&gt;<br>&lt;td rowspan = &quot;2&quot;&gt; 指令 &lt;/td&gt;<br>&lt;td&gt;IFU&lt;/td&gt;<br>&lt;td colspan = &quot;4&quot;&gt;GRF&lt;/td&gt;<br>&lt;td&gt;EXT&lt;/td&gt;<br>&lt;td colspan = &quot;2&quot;&gt;ALU&lt;/td&gt;<br>&lt;td colspan = &quot;2&quot;&gt;DM&lt;/td&gt;<br>&lt;/tr&gt;<br>&lt;tr&gt;<br>&lt;td&gt;Beq&lt;/td&gt;<br>&lt;td&gt;A1&lt;/td&gt;<br>&lt;td&gt;A2&lt;/td&gt;<br>&lt;td&gt;A3&lt;/td&gt;<br>&lt;td&gt;WD&lt;/td&gt;<br>&lt;td&gt;Imm&lt;/td&gt;<br>&lt;td&gt;A&lt;/td&gt;<br>&lt;td&gt;B&lt;/td&gt;<br>&lt;td&gt;A&lt;/td&gt;<br>&lt;td&gt;WD&lt;/td&gt;<br>&lt;/tr&gt;<br>&lt;tr&gt;<br>&lt;td&gt;add&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;IFU.Instr[25:21]&lt;/td&gt;<br>&lt;td&gt;IFU.Instr[20:16]&lt;/td&gt;<br>&lt;td&gt;IFU.Instr[15:11]&lt;/td&gt;<br>&lt;td&gt;ALU.C&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;GRF.D1&lt;/td&gt;<br>&lt;td&gt;GRF.D2&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;/tr&gt;<br>&lt;tr&gt;<br>&lt;td&gt;sub&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;IFU.Instr[25:21]&lt;/td&gt;<br>&lt;td&gt;IFU.Instr[20:16]&lt;/td&gt;<br>&lt;td&gt;IFU.Instr[15:11]&lt;/td&gt;<br>&lt;td&gt;ALU.C&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;GRF.D1&lt;/td&gt;<br>&lt;td&gt;GRF.D2&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;/tr&gt;<br>&lt;tr&gt;<br>&lt;td&gt;ori&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;IFU.Instr[25:21]&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;IFU.Instr[20:16]&lt;/td&gt;<br>&lt;td&gt;ALU.C&lt;/td&gt;<br>&lt;td&gt;IFU.Instr[15:0]&lt;/td&gt;<br>&lt;td&gt;GRF.D1&lt;/td&gt;<br>&lt;td&gt;EXT.ext&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;/tr&gt;<br>&lt;tr&gt;<br>&lt;td&gt;lw&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;IFU.Instr[25:21]&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;IFU.Instr[20:16]&lt;/td&gt;<br>&lt;td&gt;DM.Data&lt;/td&gt;<br>&lt;td&gt;IFU.Instr[15:0]&lt;/td&gt;<br>&lt;td&gt;GEF.D1&lt;/td&gt;<br>&lt;td&gt;EXT.ext&lt;/td&gt;<br>&lt;td&gt;ALU.C&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;/tr&gt;<br>&lt;tr&gt;<br>&lt;td&gt;sw&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;IFU.Instr[25:21]&lt;/td&gt;<br>&lt;td&gt;IFU.Instr[20:16]&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;IFU.Instr[15:0]&lt;/td&gt;<br>&lt;td&gt;GRF.D1&lt;/td&gt;<br>&lt;td&gt;EXT.ext&lt;/td&gt;<br>&lt;td&gt;ALU.C&lt;/td&gt;<br>&lt;td&gt;GRF.D2&lt;/td&gt;<br>&lt;/tr&gt;<br>&lt;tr&gt;<br>&lt;td&gt;lui&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;IFU.Instr[20:16]&lt;/td&gt;<br>&lt;td&gt;ALU.C&lt;/td&gt;<br>&lt;td&gt;IFU.Instr[15:0]&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;EXT.ext&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;/tr&gt;<br>&lt;tr&gt;<br>&lt;td&gt;beq&lt;/td&gt;<br>&lt;td&gt;ALU.Zero&lt;/td&gt;<br>&lt;td&gt;IFU.Instr[25:21]&lt;/td&gt;<br>&lt;td&gt;IFU.Instr[20:16]&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;GRF.D1&lt;/td&gt;<br>&lt;td&gt;GRF.D2&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;td&gt;&lt;/td&gt;<br>&lt;/tr&gt;<br>&lt;/table&gt;</li></ul><h4 id="子模块"><a class="anchor" href="#子模块">#</a> 子模块</h4><ul><li><p>取指令单元 IRU</p><table><thead><tr><th style="text-align:center">信号名</th><th style="text-align:center">方向</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">Clk</td><td style="text-align:center">Input</td><td style="text-align:center">时钟</td></tr><tr><td style="text-align:center">Reset</td><td style="text-align:center">Input</td><td style="text-align:center">异步复位 PC 到 0x00003000</td></tr><tr><td style="text-align:center">Beq</td><td style="text-align:center">Input</td><td style="text-align:center">跳转</td></tr><tr><td style="text-align:center">pc</td><td style="text-align:center">Output</td><td style="text-align:center">PC</td></tr><tr><td style="text-align:center">Instr</td><td style="text-align:center">Output</td><td style="text-align:center">下一条指令</td></tr></tbody></table></li><li><p>寄存器堆 GRF</p><table><thead><tr><th style="text-align:center">信号名</th><th style="text-align:center">方向</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">Clk</td><td style="text-align:center">Input</td><td style="text-align:center">时钟</td></tr><tr><td style="text-align:center">Reset</td><td style="text-align:center">Input</td><td style="text-align:center">异步复位</td></tr><tr><td style="text-align:center">WE</td><td style="text-align:center">Input</td><td style="text-align:center">写使能</td></tr><tr><td style="text-align:center">A1[4:0]</td><td style="text-align:center">Input</td><td style="text-align:center">操作数 1 地址</td></tr><tr><td style="text-align:center">A2[4:0]</td><td style="text-align:center">Input</td><td style="text-align:center">操作数 2 地址</td></tr><tr><td style="text-align:center">A3[4:0]</td><td style="text-align:center">Input</td><td style="text-align:center">操作数 3 地址</td></tr><tr><td style="text-align:center">WD[31:0]</td><td style="text-align:center">Input</td><td style="text-align:center">写入数据</td></tr><tr><td style="text-align:center">D1[31:0]</td><td style="text-align:center">Output</td><td style="text-align:center">读出数据 1</td></tr><tr><td style="text-align:center">D2[31:0]</td><td style="text-align:center">Output</td><td style="text-align:center">读出数据 2</td></tr></tbody></table></li><li><p>控制器 Controller</p><table><thead><tr><th style="text-align:center">信号名</th><th style="text-align:center">方向</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">Opcode[5:0]</td><td style="text-align:center">Input</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">Funct[5:0]</td><td style="text-align:center">Input</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">BeqEn</td><td style="text-align:center">Output</td><td style="text-align:center">是否为 beq</td></tr><tr><td style="text-align:center">RegWrite</td><td style="text-align:center">Output</td><td style="text-align:center">GRF 写使能</td></tr><tr><td style="text-align:center">ALUSrc</td><td style="text-align:center">Output</td><td style="text-align:center">B 为寄存器 / 立即数</td></tr><tr><td style="text-align:center">ALUOp[3:0]</td><td style="text-align:center">Output</td><td style="text-align:center">ALU 模式</td></tr><tr><td style="text-align:center">MemoryWrite</td><td style="text-align:center">Output</td><td style="text-align:center">DM 写使能</td></tr><tr><td style="text-align:center">ExtOp[1:0]</td><td style="text-align:center">Output</td><td style="text-align:center">EXT 使能和模式</td></tr><tr><td style="text-align:center">Mem2Reg</td><td style="text-align:center">Output</td><td style="text-align:center">ALU/DM 回写</td></tr></tbody></table></li><li><p>算术逻辑运算单元 ALU</p><table><thead><tr><th style="text-align:center">信号名</th><th style="text-align:center">方向</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">A[31:0]</td><td style="text-align:center">Input</td><td style="text-align:center">操作数 1</td></tr><tr><td style="text-align:center">B[31:0]</td><td style="text-align:center">Input</td><td style="text-align:center">操作数 2</td></tr><tr><td style="text-align:center">ALUOp[3:0]</td><td style="text-align:center">Input</td><td style="text-align:center">模式</td></tr><tr><td style="text-align:center">C</td><td style="text-align:center">Output</td><td style="text-align:center">运算结果</td></tr><tr><td style="text-align:center">Zero</td><td style="text-align:center">Output</td><td style="text-align:center">结果是否为零</td></tr></tbody></table></li><li><p>数据存储器 DM</p><table><thead><tr><th style="text-align:center">信号名</th><th style="text-align:center">方向</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">Clk</td><td style="text-align:center">Input</td><td style="text-align:center">时钟</td></tr><tr><td style="text-align:center">En</td><td style="text-align:center">Input</td><td style="text-align:center">写使能</td></tr><tr><td style="text-align:center">A</td><td style="text-align:center">Input</td><td style="text-align:center">读地址</td></tr><tr><td style="text-align:center">D</td><td style="text-align:center">Input</td><td style="text-align:center">写数据</td></tr><tr><td style="text-align:center">Data</td><td style="text-align:center">Output</td><td style="text-align:center">读出数据</td></tr></tbody></table></li><li><p>结合上述模块输入输出和连接关系，画出如下顶层草稿：<img data-src="images/7a4b4ed583106fa9a117b40a86634518e4eee98aba539912f218986154cdbe92.png" alt="图 0"></p></li></ul><h4 id="二级子模块和模块实现"><a class="anchor" href="#二级子模块和模块实现">#</a> 二级子模块和模块实现</h4><ul><li><p>IFU<br><img data-src="images/2d47a31b09fa074c2b0dc29091111985eefa5f302e2aee97ce357882e83e940c.jpg" alt="图 4"></p><ul><li>PC(IFU)<ul><li>寄存器加上异步复位到 0x00003000 功能，采用寄存器复位时复位至 0，因此需要在寄存器前将传入下一状态 - 0x00003000, 寄存器下游再 + 0x00003000。</li></ul></li><li>NPC（IFU）<table><thead><tr><th style="text-align:center">信号名</th><th style="text-align:center">方向</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">PC</td><td style="text-align:center">Inuput</td><td style="text-align:center">当前 PC</td></tr><tr><td style="text-align:center">Instr</td><td style="text-align:center">Input</td><td style="text-align:center">当前指令</td></tr><tr><td style="text-align:center">NPC</td><td style="text-align:center">Output</td><td style="text-align:center">下一个 PC</td></tr><tr><td style="text-align:center">PC4</td><td style="text-align:center">Output</td><td style="text-align:center">PC+4</td></tr></tbody></table></li><li>IM(IFU)<ul><li>是一个 ROM，为了使得 PC 的输出与 DM 实际地址相匹配，将 pc-0x00003000 再右移两位得到 addr。</li></ul></li></ul></li><li><p>Controller</p><ul><li>参考理论课讲解和教程，由 Contrller_AND 译码，其输入为 Opcode 和 FunctCode，输出为各指令独热码。<img data-src="images/59600af2d70e65619c614245b8ab0b97d3a535dfdde6ef74bfa407d89bf5aaa5.jpg" alt="图 1"></li><li>Controller_OR 释放控制信号，输入为指令的独热码，输出为上述各控制信号。<img data-src="images/7421e5e8c50e86b6635911f9ec1a9e313543a7691bed177bf83d7afe9feedd7e.jpg" alt="图 2"></li></ul></li><li><p>ALU</p><ul><li>根据控制信号分别进行计算，结果由多路选择器选择。</li></ul></li></ul><h2 id="测试方案"><a class="anchor" href="#测试方案">#</a> 测试方案</h2><ul><li>思路：<ul><li>编写 MIPS 代码，在 MARS 上运行并查看寄存器和内存的数值；将 MIPS 代码转换为机器代码后导入 Logisim 的 ROM 中并运行，之后查看 logisim 当中的 GRF 和 DM 数据和 MARS 中是否一致。</li><li>根据教程，先测试不依赖于其他指令，但其他指令测试需要用到的指令，如 ori，lui; 先测试 sw,lw 指令，再测试 add，sub 等指令。</li></ul></li><li>数据构造：<ul><li>进行测试的数据应该覆盖广泛，包括正数与负数，绝对值大的数，和零附近的数字；测试覆盖全部寄存器。</li><li>测试数据应包含边界条件，如包括 0；包括 0xffff 等首位为 1 的立即数以测试扩展方式的正确性；跳转指令包含跳转到自己的指令。</li><li>应用大批随机数进行测试。</li></ul></li><li>自动化<ul><li>手动编写代码测试并比对的工作过于繁重，因此利用程序生成 MIPS 代码，如使用 C 测试 ori 测试指令。</li></ul><pre><code>#include&lt;stdio.h&gt;
#include&lt;stdlib.h&gt;
#include&lt;time.h&gt;
#define BATCH_SIZE 50

FILE *pCode;

int main() &#123;
  srand((unsigned int)time(0));
  pCode = fopen(&quot;mips_code.txt&quot;,&quot;w&quot;);
  char s[120];
  int i;
  for (i = 0; i&lt; 32; i++) &#123;
          sprintf(s,&quot;ori $%d,$%d,%d\n&quot;,i,i + 1,0);
          fprintf(pCode,s);
  &#125;
  fclose(pCode);
  pCode = fopen(&quot;mips_code_ori1.txt&quot;,&quot;w&quot;);
  for (i = 0; i&lt; 32; i++) &#123;
          sprintf(s,&quot;ori $%d,$%d,%d\n&quot;,i,i + 1,0xffff);
          fprintf(pCode,s);
  &#125;
  fclose(pCode);
  pCode = fopen(&quot;mips_code_ori2.txt&quot;,&quot;w&quot;);
  for (i = 0 ; i &lt; BATCH_SIZE; i++) &#123;
      sprintf(s,&quot;ori $%d,$%d,%d\n&quot;,rand()% 32,rand()%32,rand()%0x10000);
      fprintf(pCode,s);
  &#125;
  fclose(pCode);
  return 0;
&#125;
</code></pre>其他相关代码（产生 add_sub）：<pre><code>#include&lt;stdio.h&gt;
#include&lt;string.h&gt;

int main() &#123;
  int i,j,k=0;
  for ( i = 0; i &lt; 4; i++)
  &#123;
      for(j=i;j&lt;4;j++,k++) &#123;
          printf(&quot;add $s%d,$t%d,$t%d\n&quot;,0,i*2,j*2+1);
          printf(&quot;sw $s0,%d($0)\n&quot;,k*4);
      &#125;
  &#125;
  for ( i = 0; i &lt; 4; i++)
  &#123;
      for(j=i;j&lt;4;j++,k++) &#123;
          printf(&quot;sub $s%d,$t%d,$t%d\n&quot;,0,i*2,j*2+1);
          printf(&quot;sw $s0,%d($0)\n&quot;,k*4);
      &#125;
  &#125;
  return 0;
&#125;
</code></pre></li></ul><pre><code>.data

.text
ori $t0,$0,3
ori $t1,$0,4
lui $t2,0xffff
ori $t2,$t2,0xffff
lui $t3,0xffff
ori $t3,$t3,0xfffd
lui $t4,0x7fff
ori $t4,$t4,0xffff
lui $t5,0x7fee
ori $t5,$t5,0xfeff
lui $t6,0x8000
ori $t6,$t6,0x0000
lui $t7,0x8000
ori $t7,$t7,0x0003
add $s0,$t0,$t1
sw $s0,0($0)
add $s0,$t0,$t3
sw $s0,4($0)
add $s0,$t0,$t5
sw $s0,8($0)
add $s0,$t0,$t7
sw $s0,12($0)
add $s0,$t2,$t3
sw $s0,16($0)
add $s0,$t2,$t5
sw $s0,20($0)
add $s0,$t2,$t7
sw $s0,24($0)
add $s0,$t4,$t5
sw $s0,28($0)
add $s0,$t4,$t7
sw $s0,32($0)
add $s0,$t6,$t7
sw $s0,36($0)
sub $s0,$t0,$t1
sw $s0,40($0)
sub $s0,$t0,$t3
sw $s0,44($0)
sub $s0,$t0,$t5
sw $s0,48($0)
sub $s0,$t0,$t7
sw $s0,52($0)
sub $s0,$t2,$t3
sw $s0,56($0)
sub $s0,$t2,$t5
sw $s0,60($0)
sub $s0,$t2,$t7
sw $s0,64($0)
sub $s0,$t4,$t5
sw $s0,68($0)
sub $s0,$t4,$t7
sw $s0,72($0)
sub $s0,$t6,$t7
sw $s0,76($0)
</code></pre><ul><li>MARS 结果与 Logisim 结果的自动对比目前还没有实现。</li></ul><h2 id="思考题"><a class="anchor" href="#思考题">#</a> 思考题</h2><ul><li>思考题 1：<ul><li>在 CPU 上游模块<em> Moore</em> 机中，发挥状态存储功能的是程序计数器 PC，发挥状态转移功能的是计算下个 pc 的 NPC。</li><li>在 CPU 下游模块<em> Mealy</em> 机中，发挥状态存储功能的是寄存器堆 GRF，CPU 之外的 DM；发挥状态转移功能的是控制器 Controller，运算器 ALU 和扩展单元 EXT 等。</li></ul></li><li>思考题 2：<ul><li>在本次实验的要求下，此设计是合理的。<ul><li>本实验当中，IM 中的指令相当于预置完成，在 CPU 执行过程当中，无需进行修改，且指令数量庞大，因此使用只读的存储阵列 ROM 比较合理。</li><li>GRF 存储三十二个三十二位二进制数，且要求可读可写。由于数量较少且对速度要求高，不宜使用大型阵列 RAM。另外由于访问地址是 5 位且 0 号要特殊处理，直接使用寄存器实现比较合适。</li><li>DM 是要求可读可写的大型数据存储器，使用 RAM 比较合适。</li></ul></li><li>在真实的处理器当中，IM 要求可写，否则始终只能运行同一程序。因此不能够使用 ROM。</li></ul></li><li>思考题 3：<ul><li>尚未设计其他完整的模块，但是对一些模块预留了一些接口，程序具有可扩展性。比如考虑到部分跳转相关指令可能需要将 PC+4 存入 GRF，因此 IFU 添加了 PC4 输出，也增加了新控制信号输入以及 32 位数字输入。扩展了 GRF 的 WD,A3 选择器宽度。ALUOp 预留若干位。</li></ul></li><li>思考题 4：<ul><li>nop 对应汇编语句为 &lt;kbd&gt;sll $0,$0,0&lt;/kbd&gt; , 相当于不进行任何操作，RegWrite，MemWrite 等控制信号均为零。由于控制器的控制信号释放均由或门实现，故释放的控制信号均为 0 的 nop 指令无需加入控制信号真值表。</li></ul></li><li>思考题 5:<ul><li>测试点的数据不够强。指令集当中有 sub 和 nop 未进行测试。</li><li>各个指令的情况：<ul><li>ori 指令，lui 指令基本符合测试要求，但可以进行更多数据的测试。</li><li>add 指令覆盖了正负数情况，但缺少 0 的测试，且其测试缺少较大整数（如计算完溢出，不过该情况无法在 MARS 上检查，可能要手动检查）和零附近整数的情况。</li><li>sw，lw 指令测试较强。</li><li>beq 指令覆盖了相等和不等的情况，但是只有向后跳转，没有跳转到自身和跳转到之前的情况。</li></ul></li></ul></li></ul><div class="tags"><a href="/tags/%E5%8D%95%E5%91%A8%E6%9C%9FCPU/" rel="tag"><i class="ic i-tag"></i> 单周期CPU</a> <a href="/tags/mips/" rel="tag"><i class="ic i-tag"></i> mips</a> <a href="/tags/Logisim/" rel="tag"><i class="ic i-tag"></i> Logisim</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-04-14 12:41:40" itemprop="dateModified" datetime="2024-04-14T12:41:40+08:00">2024-04-14</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Zeng Huaxu 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Zeng Huaxu 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Zeng Huaxu <i class="ic i-at"><em>@</em></i>Zeng HX's Blog</li><li class="link"><strong>本文链接：</strong> <a href="http://example.com/2024/04/13/CO_P3_document/" title="CO_P3_document">http://example.com/2024/04/13/CO_P3_document/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"></div><div class="item right"><a href="/2024/04/13/CO_P4_document/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gicm0n457cj20zk0m8e81.jpg" title="CO_P4_document"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 计算机组成</span><h3>CO_P4_document</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#cpu%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3%E5%8F%8A%E6%80%9D%E8%80%83%E9%A2%98"><span class="toc-number">1.</span> <span class="toc-text">CPU 设计文档及思考题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E8%8D%89%E7%A8%BF"><span class="toc-number">1.1.</span> <span class="toc-text">设计草稿</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B6%E5%B1%82%E6%A8%A1%E5%9D%97%E8%8D%89%E7%A8%BF"><span class="toc-number">1.1.0.1.</span> <span class="toc-text">顶层模块草稿</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B6%E5%B1%82%E6%A8%A1%E5%9D%97%E5%B7%A5%E7%A8%8B%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.1.0.2.</span> <span class="toc-text">顶层模块工程设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%90%E6%A8%A1%E5%9D%97"><span class="toc-number">1.1.0.3.</span> <span class="toc-text">子模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E7%BA%A7%E5%AD%90%E6%A8%A1%E5%9D%97%E5%92%8C%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.1.0.4.</span> <span class="toc-text">二级子模块和模块实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%96%B9%E6%A1%88"><span class="toc-number">1.2.</span> <span class="toc-text">测试方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%9D%E8%80%83%E9%A2%98"><span class="toc-number">1.3.</span> <span class="toc-text">思考题</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/2024/04/13/CO_P3_document/" rel="bookmark" title="CO_P3_document">CO_P3_document</a></li><li><a href="/2024/04/13/CO_P4_document/" rel="bookmark" title="CO_P4_document">CO_P4_document</a></li><li><a href="/2024/04/13/CO_P5_document/" rel="bookmark" title="CO_P5_document">CO_P5_document</a></li><li><a href="/2024/04/13/CO_P6_document/" rel="bookmark" title="CO_P6_document">CO_P6_document</a></li><li><a href="/2024/04/13/CO_P7_document/" rel="bookmark" title="CO_P7_document">CO_P7_document</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Zeng Huaxu" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Zeng Huaxu</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">5</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">1</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">6</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3plbmdoeFNTUw==" title="https:&#x2F;&#x2F;github.com&#x2F;zenghxSSS"><i class="ic i-github"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/computer-composition/" title="分类于 计算机组成">计算机组成</a></div><span><a href="/2024/04/13/CO_P6_document/" title="CO_P6_document">CO_P6_document</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-composition/" title="分类于 计算机组成">计算机组成</a></div><span><a href="/2024/04/13/CO_P7_document/" title="CO_P7_document">CO_P7_document</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-composition/" title="分类于 计算机组成">计算机组成</a></div><span><a href="/2024/04/13/CO_P3_document/" title="CO_P3_document">CO_P3_document</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-composition/" title="分类于 计算机组成">计算机组成</a></div><span><a href="/2024/04/13/CO_P5_document/" title="CO_P5_document">CO_P5_document</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-composition/" title="分类于 计算机组成">计算机组成</a></div><span><a href="/2024/04/13/CO_P4_document/" title="CO_P4_document">CO_P4_document</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Zeng Huaxu @ Zeng HX</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">24k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">22 分钟</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2024/04/13/CO_P3_document/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->